SET hive.exec.dynamic.partition= true;
SET hive.exec.dynamic.partition.mode = nonstrict;

Drop Table if Exists CDW_SAPP_D_BRANCH_EXT;

CREATE EXTERNAL TABLE CDW_SAPP_D_BRANCH_EXT (BRANCH_CODE INT,
											 BRANCH_NAME STRING,
											 BRANCH_STREET STRING, 
											 BRANCH_CITY STRING,
											 BRANCH_STATE STRING,
											 BRANCH_ZIP INT, 
											 BRANCH_PHONE STRING,
											 LAST_UPDATED TIMESTAMP)
ROW FORMAT DELIMITED FIELDS TERMINATED BY'\t'
LINES TERMINATED BY '\n'
LOCATION "/user/maria_dev/Credit_card_System/branch";



CREATE TABLE IF NOT EXISTS CDW_SAPP_D_BRANCH (BRANCH_CODE INT,
							    BRANCH_NAME STRING,
							    BRANCH_STREET STRING, 
							    BRANCH_CITY STRING,
							    BRANCH_ZIP INT, 
							    BRANCH_PHONE STRING,
							    LAST_UPDATED TIMESTAMP)
PARTITIONED BY(BRANCH_STATE STRING)
ROW FORMAT DELIMITED FIELDS TERMINATED BY'\t'
LINES TERMINATED BY '\n';


INSERT OVERWRITE TABLE CDW_SAPP_D_BRANCH
PARTITION (BRANCH_STATE)
SELECT BRANCH_CODE,
	   BRANCH_NAME,
	   BRANCH_STREET, 
	   BRANCH_CITY,
	   BRANCH_ZIP, 
	   BRANCH_PHONE,
	   LAST_UPDATED,
	   BRANCH_STATE
FROM CDW_SAPP_D_BRANCH_EXT;