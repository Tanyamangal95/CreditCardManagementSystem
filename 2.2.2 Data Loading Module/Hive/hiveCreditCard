SET hive.exec.dynamic.partition= true;
SET hive.exec.dynamic.partition.mode = nonstrict;

Drop Table if Exists CDW_SAPP_F_CREDIT_CARD_EXT;

CREATE EXTERNAL TABLE CDW_SAPP_F_CREDIT_CARD_EXT (CUST_CC_NO STRING,
												  TIMEID STRING,
												  CUST_SSN INT,
												  BRANCH_CODE INT,
												  TRANSACTION_TYPE STRING,
												  TRANSACTION_VALUE DOUBLE,
												  TRANSACTION_ID INT)
ROW FORMAT DELIMITED FIELDS TERMINATED BY'\t'
LINES TERMINATED BY '\n'
LOCATION "/user/maria_dev/Credit_card_System/creditcard";

CREATE TABLE IF NOT EXISTS CDW_SAPP_F_CREDIT_CARD (CUST_CC_NO STRING,
									 TIMEID STRING,
									 CUST_SSN INT,
									 BRANCH_CODE INT,
									 TRANSACTION_VALUE DOUBLE,
									 TRANSACTION_ID INT)
PARTITIONED BY(TRANSACTION_TYPE STRING)
ROW FORMAT DELIMITED FIELDS TERMINATED BY'\t'
LINES TERMINATED BY '\n';

INSERT OVERWRITE TABLE CDW_SAPP_F_CREDIT_CARD
PARTITION (TRANSACTION_TYPE)
SELECT CUST_CC_NO STRING,
	  TIMEID STRING,
	  CUST_SSN,
	  BRANCH_CODE,
	  TRANSACTION_VALUE,
	  TRANSACTION_ID,
	  TRANSACTION_TYPE
FROM CDW_SAPP_F_CREDIT_CARD_EXT;